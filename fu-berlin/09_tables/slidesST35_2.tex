\documentclass[pdfpagelabels=false, usepdftitle=false]{beamer}
\usetheme{CambridgeUS}
\usepackage[ngerman]{babel}
\usecolortheme{default}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{ulem}
\usepackage{hyperref}
\usepackage{graphics}
\usepackage{colortbl}
\hypersetup{colorlinks=true, breaklinks=true, linkcolor=STATred, menucolor=STATred, urlcolor=STATred}
\usepackage{listings}
\usepackage[longnamesfirst]{natbib}
\bibpunct{(}{)}{,}{a}{}{,}
%\newcommand*{\newblock}{}  % necessary to make beamer work with natbib
\newcommand{\Rlogo}{\raisebox{-.1mm}{\includegraphics[width=1.2em]{Rlogo.pdf}}}
\usepackage{amsmath}
\newcommand{\mymat}[1]{\boldsymbol{#1}}
\newcommand{\m}[1]{\boldsymbol{#1}}
\newcommand{\R}{\textsf{R}}
\newcommand{\code}[1]{\texttt{#1}}

\newcommand{\w}[1]{\textcolor{white}{#1}}
\newcommand{\wb}[1]{\textcolor{white}{{\bf#1}}}
\newcommand{\bl}[1]{\textcolor{pddblue}{#1}}  % blue
\newcommand{\blb}[1]{\textcolor{pddblue}{{\bf#1}}} % blue bold
\newcommand{\red}[1]{\textcolor{STATred}{#1}}  % red
\newcommand{\redb}[1]{\textcolor{STATred}{{\bf#1}}} % red bold


\newcommand{\mb}[1]{\mathbf{#1}}
\newcommand{\cbwmb}[1] {
	$\cellcolor{pddblue}\textcolor{white}{\mathbf{#1}}$
}
\newcommand{\cbw}[1] {
	\cellcolor{pddblue}\textcolor{white}{#1}
}
\newcommand{\cbwb}[1] {
	\cellcolor{pddblue}\textcolor{white}{{\bf #1}}
}

% grey row bold
\newcommand{\rowgblb}[5] {
	\rowcolor{Gray}
	\textcolor{black}{{\bf #1}} &
	\textcolor{black}{{\bf #2}} &
	\textcolor{black}{{\bf #3}} &
	\textcolor{black}{{\bf #4}} &
	\textcolor{black}{{\bf #5}}
}
\newcommand{\rowbwb}[5] {
	\rowcolor{pddblue}
	\textcolor{white}{{\bf #1}} &
	\textcolor{white}{{\bf #2}} &
	\textcolor{white}{{\bf #3}} &
	\textcolor{white}{{\bf #4}} &
	\textcolor{white}{{\bf #5}}
}

\newcommand{\crw}[1] {
	\cellcolor{STATred}\textcolor{white}{#1}
}
\newcommand{\crwb}[1] {
	\cellcolor{STATred}\textcolor{white}{{\bf #1}}
}
\newcommand{\invisibleRow} {
\w{\mb{h_x}} &\w{=}& \w{h_x (x) + h_x (x) + h_x (x) = xx} \\
}

\newcommand{\noninvisibleRow} {
\bl{\mb{h_x}} &\bl{=}& \bl{h_x (x) + h_x (x) + h_x (x) = xx} \\
}
\newcommand{\noninvisibleRowBold} {
\bl{\mb{h_x}} &\bl{{\bf =}}& \bl{{\bf h_x (x) + h_x (x) + h_x (x) = xx }} \\
}
\newcommand{\tabInvisible}[1] {
	\begin{center}
		\begin{tabular}{rllll}
		\wb{#1} & \wb{A} & \wb{B} & \wb{C} & \wb{Total} \\
		\wb{I} & \w{20} & \w{50} & \w{10} & \wb{80} \\
		\wb{II} & \w{8} & \w{19} & \w{22} & \wb{49} \\
		\wb{III} & \w{17} & \w{32} & \w{12} & \wb{61} \\
		\wb{Total} & \wb{45} & \wb{101} & \wb{44} & \wb{190} \\
		\end{tabular}
	\end{center}
}

\lstloadlanguages{R}
 \lstdefinelanguage{Renhanced}[]{R}{%
   morekeywords={library, impCoda, impKNNa, aggr, plot, class, methods, names,
   which, robCompositions, head}, deletekeywords={c},
   alsoletter={.\%},%
   alsoother={:_\$}}
 \lstset{language=Renhanced,extendedchars=true,
   basicstyle=\small\ttfamily,
   commentstyle=\color{STATgrey},
   keywordstyle=\color{STATred}\bfseries,
   showstringspaces=false,
   index=[1][keywords],
   indexstyle=\indexfonction
}

\newcommand{\indexfonction}[1]{\index{#1@\texttt{#1}}}

% Farben wie fuer TU
\definecolor{pddblue}{rgb}{.17,.31,.44}
\definecolor{pddblue2}{rgb}{.17,.36,.49}
\definecolor{pddblue3}{rgb}{.2,.35,.60}
\definecolor{tublau}{rgb}{0,0.4,0.66} % ca. #0066AA
\definecolor{rotgold}{rgb}{0.8,0.3,0}
\definecolor{pdlblue}{rgb}{.75,.85,.92}
\definecolor{pdllblue}{rgb}{.9,.95,.98}
\definecolor{pdlparchment}{rgb}{.96,.94,.89}
\definecolor{pddparchment}{rgb}{.89,.85,.69}
\definecolor{Gray}{gray}{0.75}
\definecolor{Gray2}{gray}{0.5}
\definecolor{digreen}{rgb}{.1,.31,.1}
\definecolor{diblue}{rgb}{.0,.2,.35}
\definecolor{diblue2}{rgb}{.0,.3,.2}

% Farben wie bei STAT Webauftritt
\definecolor{STATred}{rgb}{0.694,0.0,0.149}
\definecolor{STATgrey}{rgb}{0.8,0.8,0.8}

\setbeamercolor{frametitle}{fg=white,bg=STATred} %STAT
\setbeamercolor{structure}{fg=STATred}

%STAT
\setbeamercolor{palette primary}{fg=STATred, bg=STATgrey}  %oben rechts
\setbeamercolor{palette secondary}{fg=black, bg=white} % unten mitte
\setbeamercolor{palette tertiary}{fg=white, bg=STATred}
\setbeamercolor{palette quaternary}{fg=white, bg=STATred}
%STAT
\setbeamercolor{palette sidebar primary}{fg=white, bg=blue}
\setbeamercolor{palette sidebar secondary}{fg=black, bg=STATred} % kein Effekt
\setbeamercolor{palette sidebar tertiary}{fg=white, bg=blue}
\setbeamercolor{palette sidebar quaternary}{fg=white, bg=STATred}


\setbeamercolor{normal text}{fg=pddblue, bg=white}
\setbeamercolor{alerted text}{fg=black} %STAT:black

\setbeamercolor{button}{fg=white, bg=black} %STAT:black
\setbeamercolor{button border}{use=button, fg=black} %STAT:black

\setbeamercolor{navigation symbols}{fg=white, bg=black} %STAT:black
\setbeamercolor{navigation symbols dimmed}{fg=white, bg=black} %STAT:black

\setbeamertemplate{navigation symbols}{}    % Unterdrueckt die Navigationssymbole
\definecolor{pddblue}{rgb}{.17,.31,.44}
\setbeamercolor{alerted text}{fg=pddblue}

\beamertemplateballitem

\usepackage{Sweave}

% ---------------------
% begin of presentation
% ---------------------

\begin{document}
\input{slidesST35_2-concordance}
% define title and authors
\title[Part 9: Tabular data protection]{
%\raisebox{-.1mm}{\includegraphics[height=50mm]{logo}} \\
Tabular data protection}
%\pgfdeclareimage[height=0.6cm]{logo}{logo}
%\logo{\pgfuseimage{logo}}
\author[Templ]{Matthias Templ}
\institute[ZHAW, FU Berlin]{}
\date[2019]{2019}

% slides
\begin{frame}
\titlepage
\end{frame}

\setcounter{tocdepth}{1}
\section{}
\begin{frame}{Content}
\tableofcontents
\end{frame}

\color{pddblue}
\section{Introduction}
% \begin{frame}\frametitle{Notwendigkeit statistischer Geheimhaltung}
% 	\begin{itemize}
% 	    \item {\bf unterschiedliche Gr?nde} statistische Geheimhaltung (auch) in Tabellen zu betreiben\pause
% 	    \begin{itemize}
% 	        \item gesetzliche Vorgaben
% 	        \item Respondentenschutz \pause
% 	   	\end{itemize}
% 		\item {\bf Data privacy} ist ein wichtiges Thema\pause
% 	    \begin{itemize}
% 	        \item wem ''geh?ren'' meine Daten
% 	        \item kann ich mich sicher sein, dass Information nicht zu meinem Nachteil verwendet wird \pause
% 	   	\end{itemize}
% 		\item {\bf Kursziele:}
% 	    \begin{itemize}
% 	        \item Bewusst machen, wie Angreifer vorgehen
% 	        \item welche M?glichkeiten gibt es, (tabellarische) Daten zu sch?tzen
% 	  	\end{itemize}
% 	\end{itemize}
% \end{frame}

\begin{frame}\frametitle{Examples}
	\begin{itemize}
	    \item {\bf Example 1: ( Location = Municipality x;  interest in soccer x sex) }:
		\begin{scriptsize}
		\begin{center}
			\begin{tabular}{|r|ll|l|}
			\hline
			& {\bf men} 		& {\bf women} & {\bf total} \\ \hline
			{\bf soccer fan} 		& 12 & 10 & {\bf 22}\\
			{\bf not a soccer fan} 	& 93 & 85 & {\bf 178} \\ \hline
			{\bf total} 			& {\bf 105} & {\bf 95} & {\bf 200} \\ \hline
			\end{tabular}
		\end{center}
		\end{scriptsize} \pause
	    \item {\bf Example 1 (cont.): ( Location = Municipality x; team preference x sex) }:
		\begin{scriptsize}
		\begin{center}
			\begin{tabular}{|r|ll|l|}
			\hline
			& {\bf men} & {\bf women} & {\bf total} \\ \hline
			{\bf Sk Rapid Wien} & 12 & 4 & {\bf 16}\\
			{\bf Sturm Graz} 	& 0 & 3 & {\bf 3} \\
			{\bf SV Ried} 		& 0 & 3 &  {\bf 3} \\ \hline
			{\bf total} 		& {\bf 12} & {\bf 10} & {\bf 22} \\ \hline
			\end{tabular}
		\end{center}
		\end{scriptsize}
			    \item {\bf Example 2: ( Location = Municipality x; education x sex) }:
		\begin{scriptsize}
		\begin{center}
			\begin{tabular}{|r|ll|l|}
			\hline
			& {\bf men} & {\bf women} & {\bf total} \\ \hline
			{\bf primary} 	& 49 & 53 & {\bf 102}\\
			{\bf apprenticeship} 				& 34 & 23 & {\bf 56} \\
			{\bf secondary} 				& 22 & 14 &  {\bf 37} \\
			{\bf university} 	&  0 &  5 & {\bf 5} \\ \hline
			{\bf total} 				& {\bf 105} & {\bf 95} & {\bf 200} \\ \hline
			\end{tabular}
		\end{center}
		\end{scriptsize} \pause
	\end{itemize}
\end{frame}


\section{Methods}
\subsection{Statistical tables}
\begin{frame}\frametitle{tables - intro}
	\begin{itemize}
	    \item tabular data: basis are {\bf micro data} \pause
	    \item {\bf magnitude tables} and {\bf frequency tables} \pause
	    \begin{itemize}
	    	\item {\bf frequency table:} Counts of categories\pause
	    	\item {\bf magnitude table:} sum of all values of a variable. \pause
	    \end{itemize}
	    \item {\bf Generally...}
	    \begin{itemize}
	    	\item tabular data have {\bf linear dependencies} between its cells. \pause
	    	\item tabular data can be  {\bf one- or multi-dimensional}, {\bf hierarchical} and/or {\bf linked}.
		\end{itemize}
	\end{itemize}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Von Mikrodaten zur Tabelle %%%%%
\input{01_tableFromMicrodata.tex} %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Methoden der Primaersperrungen %%%%%
\input{02_primaerSperrungen.tex}%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Methoden zum Schutz von sensiblen Zellen %%%%%
\input{03_SchutzVonSensitivenZellen.tex}%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Methoden zum Schutz von sensiblen Zellen %%%%%
\input{04_Software.tex}%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[fragile]\frametitle{Minimal example}

For cell suppression:

\begin{itemize}
\item Problem must be specified in a structured manner (the most difficult task) (\textbf{makeProblem()})
\item Primary suppression according to a primary suppression rule (\textbf{primarySuppression()})
\item Apply one of the tabular protection rules (\textbf{protectTable()})
\end{itemize}

\end{frame}


\begin{frame}[fragile]\frametitle{Minimal example}

\begin{Schunk}
\begin{Sinput}
> library(sdcTable)
> data("microData1", package="sdcTable")
> # having a look at the data structure
> str(microData1)
\end{Sinput}
\begin{Soutput}
'data.frame':	100 obs. of  3 variables:
 $ region: chr  "C" "C" "A" "A" ...
 $ gender: chr  "male" "male" "male" "male" ...
 $ val   : num  9 11 10 11 18 10 6 9 5 12 ...
\end{Soutput}
\end{Schunk}

$\rightarrow$ two spanning variables ('region' and 'gender'), one
numeric ('val').

Specify hierarchical structure of 'region', levels 'A' to 'D' sum up to a total
\begin{Schunk}
\begin{Sinput}
> dim.region <- data.frame(
+  levels=c('@','@@','@@','@@','@@'),
+  codes=c('Total', 'A','B','C','D'),
+  stringsAsFactors=FALSE)
\end{Sinput}
\end{Schunk}
\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

Specify structure of hierarchical variable 'gender'


\begin{Schunk}
\begin{Sinput}
> dim.gender <- hier_create(root = "Total", 
+                 nodes = c("male", "female"))
> hier_display(dim.gender) # see result in R
\end{Sinput}
\begin{Soutput}
Total

\end{Soutput}
\end{Schunk}

\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

create a named list with each element being a data-frame
 containing information on one dimensional variable 
 
\begin{Schunk}
\begin{Sinput}
> dimList <- list(region = dim.region, gender = dim.gender)
> numVarInd <- 3
\end{Sinput}
\end{Schunk}

\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

In this example, no variables holding counts, numeric values, weights or sampling

\begin{Schunk}
\begin{Sinput}
> p1 <- makeProblem(
+   data = microData1,
+   dimList = dimList,
+   numVarInd = "val" # third variable in `data`
+ )
> print(class(p1))
\end{Sinput}
\begin{Soutput}
[1] "sdcProblem"
attr(,"package")
[1] "sdcTable"
\end{Soutput}
\end{Schunk}
\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

\begin{Schunk}
\begin{Sinput}
> p1 <- primarySuppression(
+   object = p1,
+   type = "freq",
+   maxN = 2
+ )
\end{Sinput}
\end{Schunk}

\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

Problem is set up

\begin{Schunk}
\begin{Sinput}
> df1 <- sdcProb2df(p1, addDups = TRUE,
+   addNumVars = TRUE, dimCodes = "original")
> print(df1)
\end{Sinput}
\begin{Soutput}
    strID freq sdcStatus  val region gender
 1:  0000  100         s 1284  Total  Total
 2:  0001   45         s  482  Total female
 3:  0002   55         s  802  Total   male
 4:  0100   20         s  198      A  Total
 5:  0101    2         u   20      A female
 6:  0102   18         s  178      A   male
 7:  0200   33         s  344      B  Total
 8:  0201   19         s  204      B female
 9:  0202   14         s  140      B   male
10:  0300   22         s  224      C  Total
11:  0301   10         s  106      C female
12:  0302   12         s  118      C   male
13:  0400   25         s  518      D  Total
14:  0401   14         s  152      D female
15:  0402   11         s  366      D   male
\end{Soutput}
\end{Schunk}
\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}

We now can apply an algorithms (several can be chosen) to receive protected tables

\begin{Schunk}
\begin{Sinput}
> protectedData <- protectTable(p1, 
+                    method='HITAS')
\end{Sinput}
\end{Schunk}

\end{frame}

\begin{frame}[fragile]\frametitle{Minimal example}


\begin{Schunk}
\begin{Sinput}
> summary(protectedData)
\end{Sinput}
\begin{Soutput}
######################################################
### Summary of the result object of class 'safeObj' ###
######################################################
--> The input data have been protected using algorithm HITAS.
--> The algorithm ran for 1 second.
--> To protect 1 primary sensitive cells, 3 cells need to be additionally suppressed.
--> A total of 11 cells may be published.

###################################
### Structure of protected Data ###
###################################
Classes 'data.table' and 'data.frame':	15 obs. of  5 variables:
 $ region   : chr  "Total" "Total" "Total" "A" ...
 $ gender   : chr  "Total" "female" "male" "Total" ...
 $ Freq     : num  100 45 55 20 2 18 33 19 14 22 ...
 $ val      : num  1284 482 802 198 20 ...
 $ sdcStatus: chr  "s" "s" "s" "s" ...
 - attr(*, ".internal.selfref")=<externalptr> 
 - attr(*, "index")= int 
  ..- attr(*, "__sdcStatus")= int  1 2 3 4 7 8 9 10 13 14 ...
NULL
\end{Soutput}
\begin{Sinput}
> print(getInfo(protectedData, type='finalData'))
\end{Sinput}
\begin{Soutput}
    region gender Freq  val sdcStatus
 1:  Total  Total  100 1284         s
 2:  Total female   45  482         s
 3:  Total   male   55  802         s
 4:      A  Total   20  198         s
 5:      A female    2   20         u
 6:      A   male   18  178         x
 7:      B  Total   33  344         s
 8:      B female   19  204         s
 9:      B   male   14  140         s
10:      C  Total   22  224         s
11:      C female   10  106         x
12:      C   male   12  118         x
13:      D  Total   25  518         s
14:      D female   14  152         s
15:      D   male   11  366         s
\end{Soutput}
\end{Schunk}

\end{frame}

\section{Conclusion}
\begin{frame}\frametitle{Conclusio}
	\begin{itemize}
		\item Anonymization of tabular data is very {\bf complex}. \pause
		\item Methods: \pause
		\begin{itemize} 
			\item cell suppression
			\item rounding
			\item CTA 
			\item ABS 
			\pause
		\end{itemize}
		\item all methods have its advantages and disadvantages
	\end{itemize}
	
	Guide for sdcTable:
	https://cran.r-project.org/web/packages/sdcTable/vignettes/sdcTable.html
\end{frame}



\end{document}
